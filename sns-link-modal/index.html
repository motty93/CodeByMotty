<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Share APIå¯¾å¿œ å…±æœ‰ãƒœã‚¿ãƒ³ (PC/ã‚¹ãƒãƒ›åˆ‡æ›¿)</title>

    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica,
          Arial, sans-serif;
        min-height: 150vh;
        background-color: #f4f4f4;
        padding: 20px;
      }

      #main-share-btn {
        font-size: 18px;
        padding: 12px 20px;
        border: none;
        background-color: #007bff;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      #main-share-btn:hover {
        background-color: #0056b3;
      }

      .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        z-index: 100;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .modal-content {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 400px;
        z-index: 101;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        opacity: 0;
        transition:
          opacity 0.3s ease,
          transform 0.3s ease;
      }

      .modal-content h2 {
        text-align: center;
        margin-top: 0;
        margin-bottom: 25px;
        color: #333;
      }

      body.modal-open {
        overflow: hidden;
      }
      body.modal-open .modal-overlay {
        display: block;
        opacity: 1;
      }
      body.modal-open .modal-content {
        display: block;
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      .modal-close-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        color: #aaa;
        background: #f1f1f1;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        transition:
          background-color 0.2s,
          color 0.2s;
      }
      .modal-close-btn:hover {
        background: #e0e0e0;
        color: #333;
      }

      .share-links {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      .share-links li {
        margin-bottom: 12px;
      }

      .share-links a,
      .share-links button {
        display: block;
        width: 100%;
        padding: 14px;
        border-radius: 8px;
        text-decoration: none;
        font-weight: bold;
        font-size: 16px;
        text-align: center;
        box-sizing: border-box;
        cursor: pointer;
        border: none;
        color: #ffffff;
        transition:
          filter 0.2s ease,
          transform 0.2s ease;
      }

      .share-links a:hover,
      .share-links button:hover {
        filter: brightness(0.9);
        transform: scale(1.02);
      }

      .share-links a:active,
      .share-links button:active {
        transform: scale(0.98);
      }

      .share-link-x {
        background-color: #000000;
      }
      .share-link-facebook {
        background-color: #1877f2;
      }
      .share-link-bluesky {
        background-color: #0070ff;
      }
      .share-link-discord {
        background-color: #5865f2;
      }

      .url-copy-area {
        margin-top: 25px;
        display: flex;
      }
      .url-copy-area input[type="text"] {
        flex-grow: 1;
        padding: 10px 12px;
        border: 1px solid #ccc;
        border-right: none;
        border-radius: 8px 0 0 8px;
        background: #f9f9f9;
        font-size: 14px;
        color: #555;
        outline: none;
      }
      .url-copy-area input[type="text"]:focus {
        border-color: #007bff;
      }

      .url-copy-area button {
        padding: 10px 16px;
        border: 1px solid #007bff;
        background: #007bff;
        color: white;
        font-weight: bold;
        border-radius: 0 8px 8px 0;
        cursor: pointer;
        transition: background-color 0.2s;
      }
      .url-copy-area button:hover {
        background: #0056b3;
      }
    </style>
  </head>
  <body>
    <h1>Web Share APIå¯¾å¿œ ã‚µãƒ³ãƒ—ãƒ«ãƒšãƒ¼ã‚¸</h1>
    <p>ã“ã®ãƒšãƒ¼ã‚¸ã‚’å…±æœ‰ã—ã¾ã™ã€‚</p>
    <p>ï¼ˆPCã§ã¯è‡ªä½œãƒ¢ãƒ¼ãƒ€ãƒ«ã€ã‚¹ãƒãƒ›ã§ã¯OSå…±æœ‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</p>

    <button id="main-share-btn">ã“ã®è¨˜äº‹ã‚’å…±æœ‰ã™ã‚‹ ğŸ“±ğŸ’»</button>

    <div id="share-modal-overlay" class="modal-overlay"></div>
    <div id="share-modal-content" class="modal-content">
      <button id="modal-close-btn" class="modal-close-btn">&times;</button>
      <h2>å…±æœ‰ã™ã‚‹</h2>
      <ul class="share-links">
        <li>
          <a
            id="share-link-x"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            class="share-link-x"
            >Xã§å…±æœ‰</a
          >
        </li>
        <li>
          <a
            id="share-link-facebook"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            class="share-link-facebook"
            >Facebookã§å…±æœ‰</a
          >
        </li>
        <li>
          <a
            id="share-link-bluesky"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            class="share-link-bluesky"
            >Blueskyã§å…±æœ‰</a
          >
        </li>
        <li>
          <button id="share-link-discord" class="share-link-discord">
            Discordã§å…±æœ‰ (ã‚³ãƒ”ãƒ¼)
          </button>
        </li>
      </ul>
      <div class="url-copy-area">
        <input
          type="text"
          id="share-url-input"
          readonly
          value="èª­ã¿è¾¼ã¿ä¸­..."
        />
        <button id="copy-url-btn">ã‚³ãƒ”ãƒ¼</button>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- 1. è¦ç´ ã®å–å¾— ---
        const mainShareBtn = document.getElementById("main-share-btn");
        const body = document.body;
        const modalOverlay = document.getElementById("share-modal-overlay");
        const modalCloseBtn = document.getElementById("modal-close-btn");
        const shareLinkX = document.getElementById("share-link-x");
        const shareLinkFacebook = document.getElementById(
          "share-link-facebook",
        );
        const shareLinkBluesky = document.getElementById("share-link-bluesky");
        const shareLinkDiscord = document.getElementById("share-link-discord");
        const urlInput = document.getElementById("share-url-input");
        const copyUrlBtn = document.getElementById("copy-url-btn");

        // --- 2. å…±æœ‰ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ ---
        const shareData = {
          title: document.title,
          text: `ã€Œ${document.title}ã€ã‚’ãƒã‚§ãƒƒã‚¯ï¼`,
          url: location.href,
        };

        // --- â˜…â˜…â˜… ç°¡æ˜“çš„ãªã‚¹ãƒãƒ›åˆ¤å®šé–¢æ•° â˜…â˜…â˜… ---
        function isMobile() {
          // UserAgentã‚’å°æ–‡å­—ã«ã—ã¦åˆ¤å®š
          const ua = navigator.userAgent.toLowerCase();
          return /iphone|ipod|ipad|android/.test(ua);
        }

        // --- 3. ãƒ¡ã‚¤ãƒ³ã®å…±æœ‰ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç† ---
        mainShareBtn.addEventListener("click", async () => {
          // 1. ã€Œã‚¹ãƒãƒ›ã€ã‹ã¤ã€ŒWeb Share APIãŒä½¿ãˆã‚‹ã€ã‹åˆ¤å®š
          if (isMobile() && navigator.share) {
            // --- ã€Aã€‘ã‚¹ãƒãƒ›ã®å ´åˆ ---
            console.log("ã‚¹ãƒãƒ›ãªã®ã§ Web Share API ã‚’ä½¿ç”¨ã—ã¾ã™");
            try {
              await navigator.share(shareData);
              console.log("å…±æœ‰ã«æˆåŠŸã—ã¾ã—ãŸ");
            } catch (err) {
              console.warn("å…±æœ‰ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã¾ãŸã¯å¤±æ•—ã—ã¾ã—ãŸ:", err.message);
            }
          } else {
            // --- ã€Bã€‘PCã®å ´åˆ (ã¾ãŸã¯éå¯¾å¿œã‚¹ãƒãƒ›) ---
            console.log(
              "PCã¾ãŸã¯éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ãŸã‚ã€è‡ªä½œãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™",
            );
            openPcModal();
          }
        });

        // --- 4. PCç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãé–¢æ•° ---
        function openPcModal() {
          const encodedUrl = encodeURIComponent(shareData.url);
          const encodedTitle = encodeURIComponent(shareData.title);

          shareLinkX.href = `https://twitter.com/intent/tweet?url=${encodedUrl}&text=${encodedTitle}`;
          shareLinkFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`;
          shareLinkBluesky.href = `https://bsky.app/intent/compose?text=${encodedTitle}%20${encodedUrl}`;

          urlInput.value = shareData.url;
          body.classList.add("modal-open");
        }

        // --- 5. PCç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•° ---
        function closePcModal() {
          body.classList.remove("modal-open");
        }

        modalCloseBtn.addEventListener("click", closePcModal);
        modalOverlay.addEventListener("click", closePcModal);

        // --- 6. PCç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ ---
        shareLinkDiscord.addEventListener("click", () => {
          const textToCopy = `${shareData.title} ${shareData.url}`;
          navigator.clipboard
            .writeText(textToCopy)
            .then(() => {
              alert("Discordç”¨ã«ã‚¿ã‚¤ãƒˆãƒ«ã¨URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            })
            .catch((err) => {
              console.error("ã‚³ãƒ”ãƒ¼å¤±æ•—:", err);
              alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            });
        });

        copyUrlBtn.addEventListener("click", () => {
          navigator.clipboard
            .writeText(shareData.url)
            .then(() => {
              alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
            })
            .catch((err) => {
              console.error("ã‚³ãƒ”ãƒ¼å¤±æ•—:", err);
              alert("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
            });
        });
      });
    </script>
  </body>
</html>
